

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Transaction Flow &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Hyperledger Fabric SDKs" href="fabric-sdks.html" />
    <link rel="prev" title="Architecture Explained" href="arch-deep-dive.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
<br>
<a href="https://chat.hyperledger.org">Rocket Chat</a>  <a href="https://jenkins.hyperledger.org/">CI</a>
<a href="http://stackoverflow.com/questions/tagged/hyperledger-fabric">StackOverflow</a>
<br>
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">欢迎来到 Hyperledger Fabric</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">入门指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="key_concepts.html">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html">Tutorials - 教程</a></li>
<li class="toctree-l2"><a class="reference internal" href="ops_guide.html">Operations Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_ref.html">Commands Reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="architecture.html">架构参考</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="arch-deep-dive.html">架构解读</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Transaction Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">交易流程</a></li>
<li class="toctree-l3"><a class="reference external" href="http://hyperledger-fabric-ca.readthedocs.io/en/latest">Hyperledger Fabric CA用户手册</a></li>
<li class="toctree-l3"><a class="reference internal" href="fabric-sdks.html">Hyperledger Fabric SDKs</a></li>
<li class="toctree-l3"><a class="reference internal" href="fabric-sdks.html#sdks">超级账本 SDKs</a></li>
<li class="toctree-l3"><a class="reference internal" href="channels.html">通道</a></li>
<li class="toctree-l3"><a class="reference internal" href="capability_requirements.html">功能需求</a></li>
<li class="toctree-l3"><a class="reference internal" href="couchdb_as_state_database.html">使用CouchDB作为状态数据库</a></li>
<li class="toctree-l3"><a class="reference internal" href="peer_event_services.html">节点基于通道的事件服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="readwrite.html">读写集</a></li>
<li class="toctree-l3"><a class="reference internal" href="gossip.html">Gossip数据传输协议</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Fabric-FAQ.html">Hyperledger Fabric FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="ordering-service-faq.html">Ordering Service FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary - 词汇表</a></li>
<li class="toctree-l2"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="questions.html">Still Have Questions? - 依然遇到问题？</a></li>
<li class="toctree-l2"><a class="reference internal" href="status.html">Status - 状态</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials - 教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_ref.html">Commands Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="architecture.html">架构参考</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arch-deep-dive.html">架构解读</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Transaction Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">交易流程</a></li>
<li class="toctree-l2"><a class="reference external" href="http://hyperledger-fabric-ca.readthedocs.io/en/latest">Hyperledger Fabric CA用户手册</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric-sdks.html">Hyperledger Fabric SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="fabric-sdks.html#sdks">超级账本 SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="channels.html">通道</a></li>
<li class="toctree-l2"><a class="reference internal" href="capability_requirements.html">功能需求</a></li>
<li class="toctree-l2"><a class="reference internal" href="couchdb_as_state_database.html">使用CouchDB作为状态数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="peer_event_services.html">节点基于通道的事件服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="readwrite.html">读写集</a></li>
<li class="toctree-l2"><a class="reference internal" href="gossip.html">Gossip数据传输协议</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Hyperledger Fabric FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="ordering-service-faq.html">Ordering Service FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary - 词汇表</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions? - 依然遇到问题？</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status - 状态</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="architecture.html">架构参考</a> &raquo;</li>
        
      <li>Transaction Flow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/txflow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="transaction-flow">
<h1>Transaction Flow<a class="headerlink" href="#transaction-flow" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="id1">
<h1>交易流程<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>This document outlines the transactional mechanics that take place during a standard asset
exchange.  The scenario includes two clients, A and B, who are buying and selling
radishes.  They each have a peer on the network through which they send their
transactions and interact with the ledger.</p>
<p>本文概述了资产交易过程中的事务机制。该场景包含客户A和B，在进行萝卜买卖。他们各自有一个网络节点，通过节点他们发送交易并和账本进行交互。</p>
<img alt="_images/step0.png" src="_images/step0.png" />
<p><strong>Assumptions</strong></p>
<p><strong>假设</strong></p>
<p>This flow assumes that a channel is set up and running.  The application user
has registered and enrolled with the organization’s certificate authority (CA)
and received back necessary cryptographic material, which is used to authenticate
to the network.</p>
<p>该流程假设通道已建立并正常运行。用户已注册并使用组织认证授权（CA）登记，同时获得必要的加密材料来进行网络验证。</p>
<p>The chaincode (containing a set of key value pairs representing the initial
state of the radish market) is installed on the peers and instantiated on the
channel.  The chaincode contains logic defining a set of transaction
instructions and the agreed upon price for a radish. An endorsement policy has
also been set for this chaincode, stating that both <code class="docutils literal notranslate"><span class="pre">peerA</span></code> and <code class="docutils literal notranslate"><span class="pre">peerB</span></code> must endorse
any transaction.</p>
<p>链码（包含一组代表萝卜市场初始状态的键值对）被安装在节点上并在通道上进行实例化。链码包含定义交易指令集合的逻辑和达成一致的萝卜价格。设置一项针对链码的背书策略，表明节点A和B都必须对任何交易进行背书。</p>
<img alt="_images/step1.png" src="_images/step1.png" />
<ol class="arabic simple">
<li><strong>Client A initiates a transaction</strong></li>
</ol>
<ol class="arabic simple">
<li><strong>客户A发起交易</strong></li>
</ol>
<p>What’s happening? - Client A is sending a request to purchase radishes.  The
request targets <code class="docutils literal notranslate"><span class="pre">peerA</span></code> and <code class="docutils literal notranslate"><span class="pre">peerB</span></code>, who are respectively representative of
Client A and Client B. The endorsement policy states that both peers must endorse
any transaction, therefore the request goes to <code class="docutils literal notranslate"><span class="pre">peerA</span></code> and <code class="docutils literal notranslate"><span class="pre">peerB</span></code>.</p>
<p>发生了什么？- 客户A发出萝卜购买请求。请求目标节点A和B，分别代表客户A和B。背书策略表明两个节点必须为任何交易进行背书，因而请求被发送到节点A和B。</p>
<p>Next, the transaction proposal is constructed.  An application leveraging a supported
SDK (Node, Java, Python) utilizes one of the available API’s which generates a
transaction proposal.  The proposal is a request to invoke a chaincode function
so that data can be read and/or written to the ledger (i.e. write new key value
pairs for the assets).  The SDK serves as a shim to package the transaction proposal
into the properly architected format (protocol buffer over gRPC) and takes the user’s
cryptographic credentials to produce a unique signature for this transaction proposal.</p>
<p>接下来构建交易提案。一个以可用SDK（node, java, python）为支撑的应用利用有效的API来生成交易提案。这项提案作为调用链码功能的请求来完成数据到账本的读取和/或写入（即为资产写入新的键值对）。SDK有两个作用：把交易提案包装成合适架构格式的库（基于gRPC的协议缓冲）；使用用户的加密证书来创建交易提案的唯一签名。</p>
<img alt="_images/step2.png" src="_images/step2.png" />
<ol class="arabic simple" start="2">
<li><strong>Endorsing peers verify signature &amp; execute the transaction</strong></li>
</ol>
<ol class="arabic simple" start="2">
<li><strong>背书节点验证签名&amp;执行交易</strong></li>
</ol>
<p>The endorsing peers verify (1) that the transaction proposal is well formed,
(2) it has not been submitted already in the past (replay-attack protection),
(3) the signature is valid (using MSP), and (4) that the
submitter (Client A, in the example) is properly authorized to perform
the proposed operation on that channel (namely, each endorsing peer ensures that
the submitter satisfies the channel’s <em>Writers</em> policy).
The endorsing peers take the transaction proposal inputs as
arguments to the invoked chaincode’s function. The chaincode is then
executed against the current state database to produce transaction
results including a response value, read set, and write set.  No updates are
made to the ledger at this point. The set of these values, along with the
endorsing peer’s signature is passed back as a “proposal response” to the SDK
which parses the payload for the application to consume.</p>
<p>背书节点验证（1）交易提案是完整的，（2）在过去没有被提交过（重放攻击保护），（3）签名是有效的（使用MSP），并且（4）提交者（在本例中的客户A）得到正确的授权在通道中来执行提案（即，每一个背书节点保证提交者满足通道的“写”策略。背书节点以交易提案凭证为输入，基于当前状态的数据库执行来生成交易结果，输出包括反馈值、读取集合和写入集合。截止现在账本还未进行更新。这些值的集合，背书节点的签名以及是/否的背书声明一同作为“提案反馈”被传输回到SDK，SDK对应用消耗的载荷进行解析。</p>
<p><em>{The MSP is a peer component that allows them to verify
transaction requests arriving from clients and to sign transaction results(endorsements).
The Writing policy is defined at channel creation time, and determines
which user is entitled to submit a transaction to that channel.}</em></p>
<p>{MSP是在节点组件允许节点验证客户的交易请求和签订交易结果（背书）。写策略在通道创建时定义，决定哪些用户有资格在通道中提交一个交易。}</p>
<img alt="_images/step3.png" src="_images/step3.png" />
<ol class="arabic simple" start="3">
<li><strong>Proposal responses are inspected</strong></li>
</ol>
<ol class="arabic simple" start="3">
<li><strong>审查提案反馈</strong></li>
</ol>
<p>The application verifies the endorsing peer signatures and compares the proposal
responses to determine if the proposal responses are the same. If the chaincode only queried
the ledger, the application would inspect the query response and would typically not
submit the transaction to Ordering Service. If the client application intends to submit the
transaction to Ordering Service to update the ledger, the application determines if the specified
endorsement policy has been fulfilled before submitting (i.e. did peerA and peerB both endorse).
The architecture is such that even if an application chooses not to inspect responses or otherwise
forwards an unendorsed transaction, the endorsement policy will still be enforced by peers
and upheld at the commit validation phase.</p>
<p>应用对背书节点签名进行验证，比较提案反馈来决定是否一致。如果链码只需要账本，应用将会对查询结果进行检查并且一般不会提交交易到排序服务。如果客户程序打算提交一个交易到排序服务来更新账本，程序会决定在提交前指定的背书策略是否被执行（即节点A和B都进行了背书）。这种架构可以保证即使一个应用选择不进行反馈审查或者转发了没有背书的交易，背书策略依然会被节点执行并在验证提交阶段维持。</p>
<img alt="_images/step4.png" src="_images/step4.png" />
<ol class="arabic simple" start="4">
<li><strong>Client assembles endorsements into a transaction</strong></li>
</ol>
<ol class="arabic simple" start="4">
<li><strong>客户组合交易背书</strong></li>
</ol>
<p>The application “broadcasts” the transaction proposal and response within a
“transaction message” to the Ordering Service. The transaction will contain the
read/write sets, the endorsing peers signatures and the Channel ID.  The
Ordering Service does not need to inspect the entire content of a transaction in order to perform
its operation, it simply receives
transactions from all channels in the network, orders them chronologically by
channel, and creates blocks of transactions per channel.</p>
<p>应用对交易提案进行广播，以“交易信息”对排序服务实现反馈。交易包含读/写集合，背书节点签名和通道ID。排序服务不读取交易细节，只是从网络中所有通道接收交易，根据每个通道按时间顺序调用，创建每个通道的交易区块。</p>
<img alt="_images/step5.png" src="_images/step5.png" />
<ol class="arabic simple" start="5">
<li><strong>Transaction is validated and committed</strong></li>
</ol>
<ol class="arabic simple" start="5">
<li><strong>交易验证和提交</strong></li>
</ol>
<p>The blocks of transactions are “delivered” to all peers on the channel.  The
transactions within the block are validated to ensure endorsement policy is
fulfilled and to ensure that there have been no changes to ledger state for read
set variables since the read set was generated by the transaction execution.
Transactions in the block are tagged as being valid or invalid.</p>
<p>交易区块被“发布”到通道中的所有节点。区块中的交易被验证来确保背书策略被执行并且账本的读取集合变量没有发生变化，因为读取集合是执行交易生成的。区块中的交易被标记为有效或无效。</p>
<img alt="_images/step6.png" src="_images/step6.png" />
<ol class="arabic simple" start="6">
<li><strong>Ledger updated</strong></li>
</ol>
<ol class="arabic simple" start="6">
<li><strong>账本更新</strong></li>
</ol>
<p>Each peer appends the block to the channel’s chain, and for each valid transaction
the write sets are committed to current state database. An event is emitted, to
notify the client application that the transaction (invocation) has been
immutably appended to the chain, as well as notification of whether the
transaction was validated or invalidated.</p>
<p>每个节点都把区块追加到通道的链中，对每项有效交易，写集合被提交到当前状态的数据库。发出一个事务通知客户端应用，交易（调用）被永久追加到链中，并且通知交易是有效或者无效的。</p>
<p><strong>Note</strong>: See the <span class="xref std std-ref">swimlane</span> diagram to better understand the server side flow and the
protobuffers.</p>
<p>备注：参照链码泳道图以获得服务端流程和协议缓冲的更好理解。</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fabric-sdks.html" class="btn btn-neutral float-right" title="Hyperledger Fabric SDKs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="arch-deep-dive.html" class="btn btn-neutral" title="Architecture Explained" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'master',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>